<!DOCTYPE html><html lang="cn" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>x86笔记 | Assyria</title><link rel="icon" type="image/x-icon" href="/icon.ico"><link rel="preload" as="font" crossorigin="anonymous" href="/font/Bender.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="/font/BenderLight.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="/font/JetBrainsMono-Regular.woff2"><link rel="stylesheet" href="/css/arknights.css"><style>@font-face {
  font-family: Bender;
  src: local('Bender'), url("/font/Bender.ttf"), url("/font/Bender.otf");
}
@font-face {
  font-family: BenderLight;
  src: local('BenderLight'), url("/font/BenderLight.ttf");
}
@font-face {
  font-family: 'JetBrains Mono';
  src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}
</style><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"copy"}}</script><link type="text/css" rel="stylesheet" href="/lib/encrypt/hbe.style.css"><script src="/js/gitalk.js"></script><script src="//unpkg.com/mermaid@10.5.0/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><script>if (window.localStorage.getItem('theme-mode') === 'light')
 document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark')
 document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.woff2") format('woff2');
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
 --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
 --light-background: url('/img/bk.jpg');
 --theme-encrypt-confirm: 'confirm'
}</style><script defer src="/js/arknights.js"></script><script defer src="/js/search.js"></script><script async src="/js/gitalk.js"></script><script defer type="module">import mermaid from '//unpkg.com/mermaid@10.5.0/dist/mermaid.esm.mjs';
window.mermaid = mermaid;
code.paintMermaid();
</script><script async src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script async src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script async src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script async src="/lib/encrypt/hbe.js"></script><script defer src="/lib/crypto-js.min.js"></script><script async src="/js/pjax.js"></script><script class="pjax-js">reset= () => {gitalk = new Gitalk({
 clientID: 'Ov23lizDAB0ENERHJpHs',
 clientSecret: '2d06ab5b26d26b201856723845f91408188fdcb8',
 repo: 'Assyria',
 owner: 'daju233',
 admin: ['daju233'],
 distractionFreeMode: false,
 id: CryptoJS.MD5(location.pathname)
});
if (document.querySelector("#gitalk")) gitalk.render("gitalk");document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js','data-pjax','.busuanzi'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script><script class="pjax-js">reset= () => {gitalk = new Gitalk({
 clientID: 'Ov23lizDAB0ENERHJpHs',
 clientSecret: '2d06ab5b26d26b201856723845f91408188fdcb8',
 repo: 'Assyria',
 owner: 'daju233',
 admin: ['daju233'],
 distractionFreeMode: false,
 id: CryptoJS.MD5(location.pathname)
});
if (document.querySelector("#gitalk")) gitalk.render("gitalk");document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script><meta name="generator" content="Hexo 7.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><nav><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup" tabindex="0"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem"><a class="navBlock" href="/about"><span class="navItemTitle">About</span></a></li><li class="navItem"><a class="navBlock" href="/todo-list"><span class="navItemTitle">Todo-list</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>x86笔记</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2024-06-20T16:22:19.000Z" id="date"> 2024-06-21</time></div></span><br><span>Last Update: <div class="control"><time datetime="2024-09-29T11:41:15.498Z" id="updated"> 2024-09-29</time></div></span></div></div><hr><div id="post-content"><p>对X86寄存器、概念和常见指令做一个笔记。</p>
<p>笔记来源自各大网站、博客。</p>
<h3 id="常见寄存器作用："><a href="#常见寄存器作用：" class="headerlink" title="常见寄存器作用："></a>常见寄存器作用：</h3><p>x86-64 架构的寄存器有一些使用习惯，比如：</p>
<ul>
<li><p>用来传参数的寄存器：%rdi, %rsi, %rdx, %rcx, %r8, %r9</p>
</li>
<li><p>保存返回值的寄存器：%rax</p>
</li>
<li><p>被调用者保存状态：%rbx, %r12, %r13, %r14, %rbp, %rsp</p>
</li>
<li><p>调用者保存状态：%rdi, %rsi, %rdx, %rcx, %r8, %r9, %rax, %r10, %r11</p>
</li>
<li><p>栈指针：%rsp</p>
</li>
<li><p>指令指针：%rip</p>
</li>
</ul>
<h3 id="函数调用约定："><a href="#函数调用约定：" class="headerlink" title="函数调用约定："></a>函数调用约定：</h3><ul>
<li><p><code>%rdi</code>：第一个参数</p>
</li>
<li><p><code>%rsi</code>：第二个参数</p>
</li>
<li><p><code>%rdx</code>：第三个参数</p>
</li>
<li><p><code>%rcx</code>：第四个参数</p>
</li>
<li><p><code>%r8</code>：第五个参数</p>
</li>
<li><p><code>%r9</code>：第六个参数</p>
</li>
<li><p><code>%rax</code>：返回值</p>
</li>
</ul>
<h3 id="数据传输指令："><a href="#数据传输指令：" class="headerlink" title="数据传输指令："></a>数据传输指令：</h3><p><em>源目的地址:立即数,寄存器,存储器</em></p>
<p><em>目的地址:寄存器,存储器</em></p>
<p><em>(存储器不能到存储器)</em></p>
<p>mov指令的五种形式：</p>
<p>movl 传送双字</p>
<p>movb 传送一个字节</p>
<p>movw 传送两个字节</p>
<p>这里注意:</p>
<p>&#x3D;&#x3D;movsbl&#x3D;&#x3D; &#x3D;&#x3D;movzbl&#x3D;&#x3D;指令负责拷贝一个字节,并设置目的操作数其余的位</p>
<p>区别在于:</p>
<p>movsbl源操作数是单字节,move后将24位设置为源字节的最高位（在下列例子中为F）,然后拷贝到32位中。</p>
<p>movzbl 源操作数单字节,前面加24个0扩展到32位.然后拷贝到32位中.</p>
<p>mov movsbl movzbl区别:</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">//假设 <span class="hljs-variable">%dh</span> <span class="hljs-operator">=</span><span class="hljs-number">8</span>D<span class="hljs-punctuation">,</span><span class="hljs-variable">%eax</span><span class="hljs-operator">=</span><span class="hljs-number">98765432</span> movb <span class="hljs-variable">%dh</span> <span class="hljs-variable">%al</span>      <span class="hljs-variable">%eax</span><span class="hljs-operator">=</span><span class="hljs-number">9876548</span>D                              movsbl <span class="hljs-variable">%dh</span> <span class="hljs-variable">%eax</span>   <span class="hljs-variable">%eax</span><span class="hljs-operator">=</span>FFFFFF<span class="hljs-number">8</span>D movzbl <span class="hljs-variable">%dh</span> <span class="hljs-variable">%eax</span>   <span class="hljs-variable">%eax</span><span class="hljs-operator">=</span><span class="hljs-number">0000008</span>D<br></code></pre></td></tr></table></figure>

<h3 id="调用者保存与被调用者保存"><a href="#调用者保存与被调用者保存" class="headerlink" title="调用者保存与被调用者保存"></a>调用者保存与被调用者保存</h3><p><strong>栈帧</strong>  </p>
<p>想要了解栈帧的结构？我们还是先来回顾（review）以下有哪些和函数栈相关的寄存器吧。（这儿并没有包含浮点寄存器）  </p>
<p><a target="_blank" rel="noopener" href="https://pic3.zhimg.com/80/v2-34ba84268008d644471184354939689e_720w.webp" class='item-img' data-src='https://pic3.zhimg.com/80/v2-34ba84268008d644471184354939689e_720w.webp'><img src="https://pic3.zhimg.com/80/v2-34ba84268008d644471184354939689e_720w.webp"></a></p>
<ul>
<li><p>所谓调用者保存，就是可以让被调用者（自身不作为另一个调用者）随意使用，也是为了自己用到的数据不被覆盖。</p>
</li>
<li><p>所谓被调用者保存，恰恰与调用者保存相反。</p>
</li>
<li><p>函数调用一般参数传递（非浮点）前6个参数存于寄存器，剩下的参数<strong>按照函数定义从右向左压栈</strong>。</p>
</li>
<li><p>栈指针指向函数栈栈顶。</p>
</li>
<li><p>%rax 用于保存函数调用返回值。  </p>
<p>  了解了这些寄存器，我们再来看看栈帧的结构</p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://pic3.zhimg.com/80/v2-36276a7bcf48fe2fa17f19a6873c8826_720w.webp" class='item-img' data-src='https://pic3.zhimg.com/80/v2-36276a7bcf48fe2fa17f19a6873c8826_720w.webp'><img src="https://pic3.zhimg.com/80/v2-36276a7bcf48fe2fa17f19a6873c8826_720w.webp"></a></p>
<p>就拿函数P的栈帧来说，从栈底到栈顶的方向分别存储以下内容：</p>
<ul>
<li><p>被保存的寄存器</p>
</li>
<li><p>局部变量（sub $0x18,%rsp ）</p>
</li>
<li><p>如果调用其他函数参数多于6，便有参数构造区</p>
</li>
<li><p>调用其他函数时需要将返回地址压栈</p>
</li>
</ul>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2024/06/23/%E5%9F%9F%E5%90%8D%E4%B8%8A%E8%B8%A9%E7%9A%84%E4%B8%80%E4%B8%AA%E5%B0%8F%E5%9D%91/">← Next 域名上踩的一个小坑</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2024/06/20/bomblab%E5%B0%8F%E8%AE%B0/">bomblab小记 Prev →</a></div></div></div><div id="comments"><div id="gitalk"></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧ </a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">Lorange</a></h1><div id="description"><p>Memory Database</p></div><div id="social-links"><a class="social" target="_blank" rel="noopener" href="https://github.com/daju233"><i class="fab fa-github" alt="GitHub"></i></a><a class="social" href="daju8264445@gmail.com"><i class="fa fa-envelope" alt="E-Mail"></i></a></div></div><div id="aside-block"></div><footer><nobr><span class="icp-title">copyright</span><span class="icp-content">©2022-2024 主治医师李大华</span></nobr><br><nobr><span class="icp-title">CC BY-NC-SA 4.0</span><span class="icp-content">https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh</span></nobr><br><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr> by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas></body></html>